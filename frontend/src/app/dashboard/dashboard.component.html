<div class="parent-container">
    <div class="container">
        <div class="left-section">
            <div class="search-and-filter-container">
                <div class="filter-container">
                    <div class="filter" (click)="openPopup('search-tag')">
                        <div class="icon">
                            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24">
                                <path fill="#ffffffbd"
                                    d="M11.172 2a3 3 0 0 1 2.121.879l7.71 7.71a3.41 3.41 0 0 1 0 4.822l-5.592 5.592a3.41 3.41 0 0 1-4.822 0l-7.71-7.71A3 3 0 0 1 2 11.172V6a4 4 0 0 1 4-4zM7.5 5.5a2 2 0 0 0-1.995 1.85L5.5 7.5a2 2 0 1 0 2-2" />
                            </svg>
                        </div>
                        <div class="text font-calsans">
                            SEARCH BY TAG
                        </div>
                        <span class="tag-count font-urbanist">{{ selectedTags.length }}</span>
                        @if (searchPopupVisible) {
                        <div class="popup-container search-tag" (click)="$event.stopPropagation()">
                            <app-search-tag-dialog
                                [initialSelectedTags]="selectedTags"
                                (close)="closePopup('search-tag')" 
                                (apply)="onTagsApplied($event)"
                            />
                        </div>
                        }
                    </div>
                    <div class="filter" (click)="openPopup('filter-dialog')">
                        <div class="icon">
                            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24">
                                <g fill="none" fill-rule="evenodd">
                                    <path
                                        d="m12.593 23.258l-.011.002l-.071.035l-.02.004l-.014-.004l-.071-.035q-.016-.005-.024.005l-.004.01l-.017.428l.005.02l.01.013l.104.074l.015.004l.012-.004l.104-.074l.012-.016l.004-.017l-.017-.427q-.004-.016-.017-.018m.265-.113l-.013.002l-.185.093l-.01.01l-.003.011l.018.43l.005.012l.008.007l.201.093q.019.005.029-.008l.004-.014l-.034-.614q-.005-.018-.02-.022m-.715.002a.02.02 0 0 0-.027.006l-.006.014l-.034.614q.001.018.017.024l.015-.002l.201-.093l.01-.008l.004-.011l.017-.43l-.003-.012l-.01-.01z" />
                                    <path fill="#ffffffbd"
                                        d="M3 4.5A1.5 1.5 0 0 1 4.5 3h15A1.5 1.5 0 0 1 21 4.5v2.086A2 2 0 0 1 20.414 8L15 13.414v7.424a1.1 1.1 0 0 1-1.592.984l-3.717-1.858A1.25 1.25 0 0 1 9 18.846v-5.432L3.586 8A2 2 0 0 1 3 6.586z" />
                                </g>
                            </svg>
                        </div>
                        <div class="text font-calsans">
                            FILTER
                        </div>
                        @if (filterPopupVisible) {
                        <div class="popup-container filters" (click)="$event.stopPropagation()">
                            <app-filter-dialog (close)="closePopup('filter-dialog')" />
                        </div>
                        }
                    </div>
                </div>
                <div class="search-container">
                    <div class="search-bar">
                        <div class="icon">
                            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24">
                                <path fill="currentColor"
                                    d="M15.5 14h-.79l-.28-.27a6.5 6.5 0 0 0 1.48-5.34c-.47-2.78-2.79-5-5.59-5.34a6.505 6.505 0 0 0-7.27 7.27c.34 2.8 2.56 5.12 5.34 5.59a6.5 6.5 0 0 0 5.34-1.48l.27.28v.79l4.25 4.25c.41.41 1.08.41 1.49 0s.41-1.08 0-1.49zm-6 0C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5S14 7.01 14 9.5S11.99 14 9.5 14" />
                            </svg>
                        </div>
                        <input type="text" class="search-input font-urbanist"
                            placeholder="seek and ye shall kinda maybe find" [(ngModel)]="searchTerm"
                            (input)="onSearch(searchTerm)" />
                    </div>
                </div>
            </div>
            <div class="results-text">
                <span class="font-calsans cursor-pointer mr-8" (click)="toggleSnippets()">
                    @if (viewingPublic) {
                        PUBLIC SNIPPETS
                    } @else {
                        YOUR SNIPPETS
                    }
                </span>
                <span class="font-urbanist cursor-default message"> 
                    * click to toggle between your own and the public snippets. *
                </span>
            </div>
            <div class="scroll-wrapper">
                @if (snippets.length < 1) { <div class="empty-message font-urbanist">
                    <svg xmlns="http://www.w3.org/2000/svg" width="84" height="84" viewBox="0 0 24 24">
                        <g fill="none" fill-rule="evenodd">
                            <path
                                d="m12.594 23.258l-.012.002l-.071.035l-.02.004l-.014-.004l-.071-.036q-.016-.004-.024.006l-.004.01l-.017.428l.005.02l.01.013l.104.074l.015.004l.012-.004l.104-.074l.012-.016l.004-.017l-.017-.427q-.004-.016-.016-.018m.264-.113l-.014.002l-.184.093l-.01.01l-.003.011l.018.43l.005.012l.008.008l.201.092q.019.005.029-.008l.004-.014l-.034-.614q-.005-.019-.02-.022m-.715.002a.02.02 0 0 0-.027.006l-.006.014l-.034.614q.001.018.017.024l.015-.002l.201-.093l.01-.008l.003-.011l.018-.43l-.003-.012l-.01-.01z" />
                            <path fill="#ffffff8c"
                                d="M12.916 3.244a3 3 0 0 0-1.832 0L4.55 5.34a1 1 0 0 0-.556.45L1.757 9.654a1 1 0 0 0 .56 1.453l7.14 2.292a1 1 0 0 0 1.171-.451l.372-.642v2.317a1 1 0 0 1-1.306.952l-5.838-1.873v3.278a2 2 0 0 0 1.388 1.905l5.84 1.872a3 3 0 0 0 1.832 0l5.84-1.872a2 2 0 0 0 1.389-1.905l-.002-3.278l-5.837 1.873A1 1 0 0 1 13 14.622v-2.317l.371.642a1 1 0 0 0 1.171.45l7.141-2.29a1 1 0 0 0 .56-1.454L20.006 5.79a1 1 0 0 0-.556-.45zm2.953 3.048L12 7.533L8.13 6.292l3.564-1.144a1 1 0 0 1 .611 0z" />
                        </g>
                    </svg>
                    <div class="message font-calsans">NO SNIPPETS</div>
            </div>
            }
            <div class="card-scroll-section">
                @for (
                    snippet of viewingPublic 
                    ? (searchTerm || selectedTags.length > 0 ? filteredPublicSnippets : publicSnippets)
                    : (searchTerm || selectedTags.length > 0 ? filteredSnippets : snippets);
                    track snippet
                ) {
                <app-snippet-card [title]="snippet.title" [tags]="snippet.tags ?? []"
                    [createdAt]="snippet.created_at"
                    [selected]="selectedSnippet?.id === snippet.id" (click)="setSelectedSnippet(snippet)" />
                }
            </div>
        </div>
        <div class="cta-container font-calsans" (click)="openSnippetDialog('create')">
            @if (snippets.length < 1) { CREATE A SNIPPET } @else { WHATS ONE MORE? } </div>
        </div>
        <div class="right-section">
            <div class="profile-container font-innertight">
                <div class="text">hi, <span>{{ userName }}</span></div>
            </div>
            <div class="code-container" #codeContainer>
                @if (selectedSnippet) {
                <div class="snippet-topbar">
                    @if (selectedSnippet.language) {
                    <div class="language font-calsans">
                        {{ selectedSnippet.language.toUpperCase() }}
                    </div>
                    } @else {
                    <div class="language font-calsans">
                        BREAD
                    </div>
                    }
                    <div class="snippet-actions">
                        <div class="action" (click)="copyCode()">
                            <svg xmlns="http://www.w3.org/2000/svg" width="22" height="22" viewBox="0 0 24 24">
                                <g fill="none" stroke="#ffffffbd" stroke-width="1.5">
                                    <path d="M6 11c0-2.828 0-4.243.879-5.121C7.757 5 9.172 5 12 5h3c2.828 0 4.243 0 5.121.879C21 6.757 21 8.172 21 11v5c0 2.828 0 4.243-.879 5.121C19.243 22 17.828 22 15 22h-3c-2.828 0-4.243 0-5.121-.879C6 20.243 6 18.828 6 16z" />
                                    <path d="M6 19a3 3 0 0 1-3-3v-6c0-3.771 0-5.657 1.172-6.828S7.229 2 11 2h4a3 3 0 0 1 3 3" />
                                </g>
                            </svg>
                        </div>
                        @if (!viewingPublic) {
                            <div class="action" (click)="openSnippetDialog('edit', selectedSnippet)">
                                <svg xmlns="http://www.w3.org/2000/svg" width="22" height="22" viewBox="0 0 24 24">
                                    <g fill="none" stroke="#ffffffbd" stroke-linecap="round" stroke-linejoin="round"
                                        stroke-width="2">
                                        <path d="M7 7H6a2 2 0 0 0-2 2v9a2 2 0 0 0 2 2h9a2 2 0 0 0 2-2v-1" />
                                        <path d="M20.385 6.585a2.1 2.1 0 0 0-2.97-2.97L9 12v3h3zM16 5l3 3" />
                                    </g>
                                </svg>
                            </div>
                            <div class="action" (click)="deleteSnippet()">
                                <svg xmlns="http://www.w3.org/2000/svg" width="22" height="22" viewBox="0 0 24 24">
                                    <path fill="#ffffffbd" d="M19 4h-3.5l-1-1h-5l-1 1H5v2h14M6 19a2 2 0 0 0 2 2h8a2 2 0 0 0 2-2V7H6z" />
                                </svg>
                            </div>
                        }
                    </div>
                </div>
                <app-monaco-editor [code]="selectedSnippet.code" [language]="selectedSnippet.language"
                    [readonly]="true" />
                } @else {
                @if (snippets.length < 1) { <div class="message-container font-calsans">
                    <div class="message cursor-pointer" (click)="openSnippetDialog('create')">
                        CREATE YOUR OWN SNIPPET
                    </div>
                    <div class="sub-message cursor-default">OR</div>
                    <div class="message cursor-pointer" (click)="toggleSnippets()">SEE WHAT OTHER PEOPLE HAVE CREATED</div>
            </div>
            } @else {
                <div class="message-container font-calsans">
                    <div class="message cursor-pointer" (click)="selectSnippet()">
                        CLICK ON A SNIPPET TO VIEW IT
                    </div>
                    <div class="sub-message cursor-default">OR</div>
                    <div class="message cursor-pointer" (click)="toggleSnippets()">SEE WHAT OTHER PEOPLE HAVE CREATED</div>
                </div>
                }
            }
        </div>
    </div>
</div>
</div>